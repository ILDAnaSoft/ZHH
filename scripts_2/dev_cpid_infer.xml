<marlin>

<execute>
  <processor name="AIDA"/>
  <processor name="InitDD4hep"/>
  <processor name="Statusmonitor"/>
  <!--processor name="FastJetOverlay"/> -->
  <!--
  <processor name="JC6FT"/>
  <processor name="EF6"/>
  -->

  <if condition="${RundEdxCorrections}">
    <processor name="ComputeCorrectAngulardEdX"/>
    <processor name="LikelihoodPID"/>
    <processor name="LeptonID"/>
    <processor name="ComprehensivePID"/>
  </if>

  <!--
  <processor name="MyCheatedMCOverlayRemoval" />
  <processor name="MyIsolatedLeptonTaggingProcessor"/>
  -->

  <processor name="LCIOOutputProcessor"/>
</execute>

<global>
  <parameter name="LCIOInputFiles">
    /pnfs/desy.de/ilc/prod/ilc/mc-opt-3/ild/dst-merged/500-TDR_ws/4f_WW_hadronic/ILD_l5_o1_v02/v02-00-01/rv02-00-01.sv02-00-01.mILD_l5_o1_v02.E500-TDR_ws.I250006.P4f_ww_h.eL.pR.n001.d_dstm_10398_0.slcio
    /pnfs/desy.de/ilc/prod/ilc/mc-opt-3/ild/dst-merged/500-TDR_ws/4f_WW_hadronic/ILD_l5_o1_v02/v02-00-01/rv02-00-01.sv02-00-01.mILD_l5_o1_v02.E500-TDR_ws.I250006.P4f_ww_h.eL.pR.n001.d_dstm_10398_1.slcio
    /pnfs/desy.de/ilc/prod/ilc/mc-opt-3/ild/dst-merged/500-TDR_ws/4f_WW_hadronic/ILD_l5_o1_v02/v02-00-01/rv02-00-01.sv02-00-01.mILD_l5_o1_v02.E500-TDR_ws.I250006.P4f_ww_h.eL.pR.n001.d_dstm_10398_2.slcio
    /pnfs/desy.de/ilc/prod/ilc/mc-opt-3/ild/dst-merged/500-TDR_ws/4f_WW_hadronic/ILD_l5_o1_v02/v02-00-01/rv02-00-01.sv02-00-01.mILD_l5_o1_v02.E500-TDR_ws.I250006.P4f_ww_h.eL.pR.n002.d_dstm_10398_3.slcio
    /pnfs/desy.de/ilc/prod/ilc/mc-opt-3/ild/dst-merged/500-TDR_ws/4f_WW_hadronic/ILD_l5_o1_v02/v02-00-01/rv02-00-01.sv02-00-01.mILD_l5_o1_v02.E500-TDR_ws.I250006.P4f_ww_h.eL.pR.n002.d_dstm_10398_4.slcio
    /pnfs/desy.de/ilc/prod/ilc/mc-opt-3/ild/dst-merged/500-TDR_ws/4f_WW_hadronic/ILD_l5_o1_v02/v02-00-01/rv02-00-01.sv02-00-01.mILD_l5_o1_v02.E500-TDR_ws.I250006.P4f_ww_h.eL.pR.n002.d_dstm_10398_5.slcio
    /pnfs/desy.de/ilc/prod/ilc/mc-opt-3/ild/dst-merged/500-TDR_ws/4f_WW_hadronic/ILD_l5_o1_v02/v02-00-01/rv02-00-01.sv02-00-01.mILD_l5_o1_v02.E500-TDR_ws.I250006.P4f_ww_h.eL.pR.n003.d_dstm_10398_6.slcio
    /pnfs/desy.de/ilc/prod/ilc/mc-opt-3/ild/dst-merged/500-TDR_ws/4f_WW_hadronic/ILD_l5_o1_v02/v02-00-01/rv02-00-01.sv02-00-01.mILD_l5_o1_v02.E500-TDR_ws.I250006.P4f_ww_h.eL.pR.n003.d_dstm_10398_7.slcio
  </parameter>
  <parameter name="MaxRecordNumber" value="0" />
  <parameter name="SkipNEvents" value="0" />
  <parameter name="SupressCheck" value="false" />
  <parameter name="Verbosity" options="DEBUG0-4,MESSAGE0-4,WARNING0-4,ERROR0-4,SILENT"> DEBUG </parameter>
</global>

<constants>
  <constant name="ILDConfigDir" value="" />
  <constant name="OutputDir" value="." />
  <constant name="OutputSuffix" value="" />
  <constant name="ZHH_REPO_ROOT" value="" />
  
  <constant name="MCParticleCollectionName" value="MCParticle" />
  <constant name="ProductionDir" value="${ILDConfigDir}/StandardConfig/production" />
  <constant name="RundEdxCorrections" value="true" />
  <constant name="RunInference" value="false" />
  <constant name="lcgeo_DIR" value=$lcgeo_DIR/>
</constants>

<processor name="AIDA" type="AIDAProcessor">
  <parameter name="Compress" type="int"> 1 </parameter>
  <parameter name="FileName" type="string"> ${OutputDir}/AIDAFile_${OutputSuffix}.root </parameter>
  <parameter name="FileType" type="string"> root </parameter>
</processor>

<processor name="InitDD4hep" type="InitializeDD4hep">
  <parameter name="DD4hepXMLFile" type="string"> /cvmfs/sw.hsf.org/key4hep/releases/2024-03-10/x86_64-almalinux9-gcc11.3.1-opt/k4geo/0.20-hapqru/share/k4geo/ILD/compact/ILD_l5_v02/ILD_l5_v02.xml </parameter>
  <parameter name="Verbosity"> SILENT </parameter>
</processor>

<processor name="Statusmonitor" type="Statusmonitor">
    <!--Statusmonitor prints out information on running Marlin Job: Prints number of runs run and current number of the event. Counting is sequential and not the run or event ID.-->
    <!--Print the event number every N events-->
    <parameter name="HowOften" type="int"> 1 </parameter>
    <!--verbosity level of this processor ("DEBUG0-4,MESSAGE0-4,WARNING0-4,ERROR0-4,SILENT")-->
    <!-- <parameter name="Verbosity" type="string">MESSAGE </parameter> -->
</processor>


<processor name="FastJetOverlay" type="FastJetProcessor">
  <parameter name="recParticleIn" type="string" lcioInType="ReconstructedParticle"> PandoraPFOs </parameter>
  <parameter name="jetOut" type="string" lcioOutType="ReconstructedParticle"> PFOsminusoverlayJets </parameter>
  <parameter name="algorithm" type="StringVec"> ee_genkt_algorithm 3.0 1.0 </parameter>
  <parameter name="clusteringMode" type="StringVec"> ExclusiveNJets 2 </parameter>
  <parameter name="recombinationScheme" type="string">E_scheme </parameter>
</processor>

<processor name="ExpandJet" type="ExpandJetProcessor">
  <parameter name="InputCollection" type="string"> PFOsminusoverlayJets </parameter>
  <parameter name="OutputCollection" type="string"> PFOsminusoverlay </parameter>
</processor>

<processor name="MyCheatedMCOverlayRemoval" type="CheatedMCOverlayRemoval">
    <parameter name="RecoParticleCollection" type="string"  lcioInType="ReconstructedParticle">PandoraPFOs</parameter>
    <parameter name="MCParticleCollection" type="string"  lcioInType="MCParticle">${MCParticleCollectionName}</parameter>
    <parameter name="RecoMCTruthLink" type="string" lcioInType="LCRelation">RecoMCTruthLink</parameter>
    <parameter name="MCTruthRecoLink" type="string" lcioInType="LCRelation">MCTruthRecoLink</parameter>
    <parameter name="OutputPfoCollection" type="string" lcioOutType="ReconstructedParticle">PFOsWithoutOverlay</parameter>
    <parameter name="Verbosity" type="string">SILENT</parameter>
</processor>

<processor name="MyIsolatedLeptonTaggingProcessor" type="IsolatedLeptonTaggingProcessor">
  <!--IsolatedLeptonTaggingProcessor does whatever it does ...-->
  <!--cosine of the larger cone-->
  <parameter name="CosConeLarge" type="float">0.95</parameter>
  <!--cosine of the smaller cone-->
  <parameter name="CosConeSmall" type="float">0.98</parameter>
  <!--Cut on the mva output of isolated electron selection-->
  <parameter name="CutOnTheISOElectronMVA" type="float">0.5</parameter>
  <!--Cut on the mva output of isolated muon selection-->
  <parameter name="CutOnTheISOMuonMVA" type="float">0.7</parameter>
  <!--Directory of Weights for the Isolated Electron MVA Classification-->
  <parameter name="DirOfISOElectronWeights" type="string">/cvmfs/ilc.desy.de/sw/x86_64_gcc82_centos7/v02-02-02/MarlinReco/v01-31/Analysis/IsolatedLeptonTagging/example/isolated_electron_weights</parameter>
  <!--Directory of Weights for the Isolated Muon MVA Classification-->
  <parameter name="DirOfISOMuonWeights" type="string">/cvmfs/ilc.desy.de/sw/x86_64_gcc82_centos7/v02-02-02/MarlinReco/v01-31/Analysis/IsolatedLeptonTagging/example/isolated_muon_weights_woYoke</parameter>
  <!--Name of the PandoraPFOs collection-->
  <parameter name="InputPandoraPFOsCollection" type="string" lcioInType="ReconstructedParticle">PFOsWithoutOverlay</parameter>
  <!--Name of the Primary Vertex collection-->
  <parameter name="InputPrimaryVertexCollection" type="string" lcioInType="Vertex">PrimaryVertex</parameter>
  <!--flag to select one most like isolated lepton-->
  <parameter name="IsSelectingOneIsoLep" type="bool">false</parameter>
  <!--Maximum d0 significance for electron-->
  <parameter name="MaxD0SigForElectron" type="float">50</parameter>
  <!--Maximum D0 significance for muon-->
  <parameter name="MaxD0SigForMuon" type="float">20</parameter>
  <!--Maximum ratio of energy in calorimeters over momentum for electron-->
  <parameter name="MaxEOverPForElectron" type="float">1.3</parameter>
  <!--Maximum ratio of energy in calorimeters over momentum for muon-->
  <parameter name="MaxEOverPForMuon" type="float">0.3</parameter>
  <!--Maximum Z0 significance for electron-->
  <parameter name="MaxZ0SigForElectron" type="float">50</parameter>
  <!--Maximum Z0 significance for muon-->
  <parameter name="MaxZ0SigForMuon" type="float">20</parameter>
  <!--minimum ratio of energy in calorimeters over momentum for electron-->
  <parameter name="MinEOverPForElectron" type="float">0.5</parameter>
  <!--minimum ratio of energy in ecal over energy in ecal+hcal-->
  <parameter name="MinEecalOverTotEForElectron" type="float">0.9</parameter>
  <!--Minimum energy in yoke for electron-->
  <parameter name="MinEyokeForMuon" type="float">1.2</parameter>
  <!--Minimum momentum for electron-->
  <parameter name="MinPForElectron" type="float">5</parameter>
  <!--Minimum momentum for muon-->
  <parameter name="MinPForMuon" type="float">5</parameter>
  <!--Name of collection with the selected isolated lepton-->
  <parameter name="OutputIsoLeptonsCollection" type="string" lcioOutType="ReconstructedParticle">ISOLeptons</parameter>
  <!--Name of the new PFOs collection without isolated lepton-->
  <parameter name="OutputPFOsWithoutIsoLepCollection" type="string" lcioOutType="ReconstructedParticle">PandoraPFOsWithoutIsoLep</parameter>
  <!--use yoke for muon ID-->
  <parameter name="UseYokeForMuonID" type="bool">false</parameter>
  <!--verbosity level of this processor ("DEBUG0-4,MESSAGE0-4,WARNING0-4,ERROR0-4,SILENT")-->
  <parameter name="Verbosity" type="string">SILENT</parameter>
</processor>

<processor name="JC6FT" type="LcfiplusProcessor">
  <!-- run primary and secondary vertex finders -->
  <parameter name="Algorithms" type="stringVec"> JetClustering JetVertexRefiner FlavorTag ReadMVA </parameter>
  <parameter name="Verbosity" type="string">SILENT</parameter>

  <!-- general parameters -->
  <parameter name="PFOCollection" type="string" value="PandoraPFOsWithoutIsoLep" /> <!-- input PFO collection -->
  <parameter name="UseMCP" type="int" value="0" /> <!-- MC info not used -->
  <parameter name="MCPCollection" type="string" value="" /> <!-- not used -->
  <parameter name="MCPFORelation" type="string" value="" /> <!-- not used -->
  <parameter name="ReadSubdetectorEnergies" type="int" value="1"/> <!-- true for ILD -->
  <parameter name="UpdateVertexRPDaughters" type="int" value="0"/> <!-- false for non-updative PandoraPFOs -->
  <parameter name="TrackHitOrdering" type="int" value="1"/> <!-- Track hit ordering: 0=ILD-LOI,SID-DBD, 1=ILD-DBD -->
  <parameter name="PrintEventNumber" type="int" value="1"/> <!-- 0 for not printing event number, n for printing every n events -->

  <!-- jet clustering parameters -->
  <parameter name="JetClustering.PrimaryVertexCollectionName" type="string" value="PrimaryVertex" />
  <parameter name="JetClustering.InputVertexCollectionName" type="string" value="BuildUpVertex" /> <!-- vertex collections to be used in JC -->
  <parameter name="JetClustering.OutputJetCollectionName" type="stringVec" value="Vertex6Jets" /> <!-- output collection name, may be multiple -->
  <parameter name="JetClustering.NJetsRequested" type="intVec">6</parameter> <!-- Multiple NJets can be specified -->
  <parameter name="JetClustering.YCut" type="doubleVec" value="0." /> <!-- specify 0 if not used -->

  <parameter name="JetClustering.JetAlgorithm" type="string" value="DurhamVertex" /> <!-- jet algorithm -->
  <parameter name="JetClustering.UseBeamJets" type="int" value="0" /> <!-- beam jet rejection -->
  <!--parameter name="JetClustering.RParameter" type="float" value="1.0" /--> <!-- kt, Valencia -->
  <!--parameter name="JetClustering.AlphaParameter" type="float" value="1.3" /--> <!-- Durham beam rejection -->
  <!--parameter name="JetClustering.BetaParameter" type="float" value="1.0" /--> <!-- Valencia -->
  <!--parameter name="JetClustering.GammaParameter" type="float" value="1.0" /--> <!-- Valencia -->

  <parameter name="JetClustering.UseMuonID" type="int" value="1" /> <!-- jet-muon ID for jet clustering -->
  <parameter name="JetClustering.MuonIDExternal" type="int" value="0" /> <!-- true to use LikelihoodPID, false for good-old simple one -->
  <parameter name="JetClustering.MuonIDMinimumD0Significance" type="double" value="5." /> <!-- min D0 significance -->
  <parameter name="JetClustering.MuonIDMinimumZ0Significance" type="double" value="5." /> <!-- min Z0 significance -->
  <parameter name="JetClustering.MuonIDMaximum3DImpactParameter" type="double" value="5." /> <!-- max 3D significance -->
  <parameter name="JetClustering.MuonIDMinimumProbability" type="double" value="0.5" /> <!-- min PID probability, only for external -->

  <parameter name="JetClustering.VertexSelectionMinimumDistance" type="double" value="0.3" /> <!-- in mm -->
  <parameter name="JetClustering.VertexSelectionMaximumDistance" type="double" value="30." /> <!-- in mm -->
  <parameter name="JetClustering.VertexSelectionK0MassWidth" type="double" value="0.02" /> <!-- in GeV -->
  <parameter name="JetClustering.YAddedForJetVertexVertex" type="double" value="100"/> <!-- add penalty for combining vertices -->
  <parameter name="JetClustering.YAddedForJetLeptonVertex" type="double" value="100"/> <!-- add penalty for combining lepton and vertex -->
  <parameter name="JetClustering.YAddedForJetLeptonLepton" type="double" value="100"/> <!-- add penalty for combining leptons -->

  <parameter name="JetVertexRefiner.InputJetCollectionName" type="string" value="Vertex6Jets" />
  <parameter name="JetVertexRefiner.OutputJetCollectionName" type="string" value="Refined6Jets" />
  <parameter name="JetVertexRefiner.PrimaryVertexCollectionName" type="string" value="PrimaryVertex" />
  <parameter name="JetVertexRefiner.InputVertexCollectionName" type="string" value="BuildUpVertex" />
  <parameter name="JetVertexRefiner.V0VertexCollectionName" type="string" value="BuildUpVertex_V0" />
  <parameter name="JetVertexRefiner.OutputVertexCollectionName" type="string" value="RefinedVertex6Jets" />

  <parameter name="JetVertexRefiner.MinPosSingle" type="double" value="0.3" />
  <parameter name="JetVertexRefiner.MaxPosSingle" type="double" value="30." />
  <parameter name="JetVertexRefiner.MinEnergySingle" type="double" value="1." />
  <parameter name="JetVertexRefiner.MaxAngleSingle" type="double" value="0.5" />
  <parameter name="JetVertexRefiner.MaxSeparationPerPosSingle" type="double" value="0.1" />
  <parameter name="JetVertexRefiner.mind0sigSingle" type="double" value="5." />
  <parameter name="JetVertexRefiner.minz0sigSingle" type="double" value="5." />
  <parameter name="JetVertexRefiner.OneVertexProbThreshold" type="double" value="0.001" />
  <parameter name="JetVertexRefiner.MaxCharmFlightLengthPerJetEnergy" type="double" value="0.1" />

  <!-- FlavorTag parameters -->
  <parameter name="PrimaryVertexCollectionName" type="string" value="PrimaryVertex" />
  <parameter name="FlavorTag.JetCollectionName" type="string" value="Refined6Jets" />
  <parameter name="MakeNtuple.AuxiliaryInfo" type="int" value="-1" />

  <parameter name="FlavorTag.WeightsDirectory" type="string" value="${ILDConfigDir}/LCFIPlusConfig/lcfiweights"/>
  <parameter name="FlavorTag.WeightsPrefix" type="string" value="6q500_v04_p00_ildl5" />
  <parameter name="FlavorTag.BookName" type="string" value="bdt" />
  <parameter name="FlavorTag.PIDAlgo" type="string" value="lcfiplus" />

  <parameter name="FlavorTag.D0ProbFileName" type="string" value="${ILDConfigDir}/LCFIPlusConfig/vtxprob/d0probv2_ildl5_6q500.root"/>
  <parameter name="FlavorTag.Z0ProbFileName" type="string" value="${ILDConfigDir}/LCFIPlusConfig/vtxprob/z0probv2_ildl5_6q500.root"/>

  <parameter name="FlavorTag.CategoryDefinition1" type="string">nvtx==0</parameter>
  <parameter name="FlavorTag.CategoryPreselection1" type="string">trk1d0sig!=0</parameter>
  <parameter name="FlavorTag.CategoryVariables1" type="stringVec">
  trk1d0sig trk2d0sig trk1z0sig trk2z0sig trk1pt_jete trk2pt_jete jprobr25sigma jprobz25sigma
  d0bprob2 d0cprob2 d0qprob2 z0bprob2 z0cprob2 z0qprob2 nmuon nelectron trkmass
  </parameter>
  <parameter name="FlavorTag.CategorySpectators1" type="stringVec">
  aux nvtx
  </parameter>

  <parameter name="FlavorTag.CategoryDefinition2" type="string">nvtx==1&&nvtxall==1</parameter>
  <parameter name="FlavorTag.CategoryPreselection2" type="string">trk1d0sig!=0</parameter>
  <parameter name="FlavorTag.CategoryVariables2" type="stringVec">
  trk1d0sig trk2d0sig trk1z0sig trk2z0sig trk1pt_jete trk2pt_jete jprobr2 jprobz2
  vtxlen1_jete vtxsig1_jete vtxdirang1_jete vtxmom1_jete vtxmass1 vtxmult1 vtxmasspc vtxprob
  d0bprob2 d0cprob2 d0qprob2 z0bprob2 z0cprob2 z0qprob2
  trkmass nelectron nmuon
  </parameter>
  <parameter name="FlavorTag.CategorySpectators2" type="stringVec">
  aux nvtx
  </parameter>

  <parameter name="FlavorTag.CategoryDefinition3" type="string">nvtx==1&&nvtxall==2</parameter>
  <parameter name="FlavorTag.CategoryPreselection3" type="string">trk1d0sig!=0</parameter>
  <parameter name="FlavorTag.CategoryVariables3" type="stringVec">
  trk1d0sig trk2d0sig trk1z0sig trk2z0sig trk1pt_jete trk2pt_jete jprobr2 jprobz2
  vtxlen1_jete vtxsig1_jete vtxdirang1_jete vtxmom1_jete vtxmass1 vtxmult1 vtxmasspc vtxprob
  1vtxprob vtxlen12all_jete vtxmassall
  </parameter>
  <parameter name="FlavorTag.CategorySpectators3" type="stringVec">
  aux nvtx
  </parameter>

  <parameter name="FlavorTag.CategoryDefinition4" type="string">nvtx>=2</parameter>
  <parameter name="FlavorTag.CategoryPreselection4" type="string">trk1d0sig!=0</parameter>
  <parameter name="FlavorTag.CategoryVariables4" type="stringVec">
  trk1d0sig trk2d0sig trk1z0sig trk2z0sig trk1pt_jete trk2pt_jete jprobr2 jprobz2
  vtxlen1_jete vtxsig1_jete vtxdirang1_jete vtxmom1_jete vtxmass1 vtxmult1 vtxmasspc vtxprob
  vtxlen2_jete vtxsig2_jete vtxdirang2_jete vtxmom2_jete vtxmass2 vtxmult2
  vtxlen12_jete vtxsig12_jete vtxdirang12_jete vtxmom_jete vtxmass vtxmult
  1vtxprob
  </parameter>
  <parameter name="FlavorTag.CategorySpectators4" type="stringVec">
  aux nvtx
  </parameter>
</processor>

<processor name="EF6" type="ErrorFlow">
  <parameter name="InputPFOCollection" type="string" lcioInType="ReconstructedParticle"> Refined6Jets </parameter>
  <parameter name="OutputPFOCollection" type="string" lcioInType="ReconstructedParticle"> Refined6JetsEF </parameter>
  <parameter name="InputMCTruthLinkCollection" type="string" lcioInType="LCRelation"> RecoMCTruthLink </parameter>
</processor>

<processor name="ComputeCorrectAngulardEdX" type="AngularCorrection_dEdxProcessor">
  <!-- description not set by author -->
  <!--parameter for new angular correction dedx= uncorrected_dedx  / f, with f= pol3(lambda)-->
  <!-- Parameters for 2020 DST (and all generated with v02-02 and v02-02-01 -->
  <parameter name="AngularCorrectionParameters" type="FloatVec"> 0.970205 0.0007506 4.41781e-8 5.8222e-8 </parameter>
  <!--LDC track collection name-->
  <parameter name="LDCTrackCollection" type="string" lcioInType="Track">MarlinTrkTracks </parameter>
  <!--parameters used in the outdated angular correction outdated_dedx= uncorrected_dedx / f, with f = 1. / ( 1.0+[1]*cos(theta)*cos(theta)/[0] )-->
</processor>

<!-- Post reconstruction related : PID, Vertexing, Particle finding, cluster topology -->
<processor name="LikelihoodPID" type="LikelihoodPIDProcessor">
  <!--Performs particle identification-->
  <!--Debugging?-->
  <parameter name="Debug" type="int">0</parameter>
  <!--Boundaries for energy binning-->
  <parameter name="EnergyBoundaries" type="FloatVec">0 1.0e+07</parameter>
  <!--Name of files containing pdfs for charged particles-->
  <parameter name="FilePDFName" type="StringVec"> ${ProductionDir}/HighLevelReco/PIDFiles/LikelihoodPID_Standard_l5_v01.root </parameter>
  <!--Whether MVA low momentum mu/pi is used or not-->
  <parameter name="UseLowMomentumMuPiSeparation" type="bool">true</parameter>
  <!--The BDTG weights files for low momentum mu/pi separation-->
  <parameter name="FileWeightFormupiSeparationName" type="StringVec">${ProductionDir}/HighLevelReco/PIDFiles/LowMomMuPiSeparation/TMVAClassification_BDTG_l5_02GeVP_clusterinfo.weights.xml ${ProductionDir}/HighLevelReco/PIDFiles/LowMomMuPiSeparation/TMVAClassification_BDTG_l5_03GeVP_clusterinfo.weights.xml ${ProductionDir}/HighLevelReco/PIDFiles/LowMomMuPiSeparation/TMVAClassification_BDTG_l5_04GeVP_clusterinfo.weights.xml ${ProductionDir}/HighLevelReco/PIDFiles/LowMomMuPiSeparation/TMVAClassification_BDTG_l5_05GeVP_clusterinfo.weights.xml ${ProductionDir}/HighLevelReco/PIDFiles/LowMomMuPiSeparation/TMVAClassification_BDTG_l5_06GeVP_clusterinfo.weights.xml ${ProductionDir}/HighLevelReco/PIDFiles/LowMomMuPiSeparation/TMVAClassification_BDTG_l5_07GeVP_clusterinfo.weights.xml ${ProductionDir}/HighLevelReco/PIDFiles/LowMomMuPiSeparation/TMVAClassification_BDTG_l5_08GeVP_clusterinfo.weights.xml ${ProductionDir}/HighLevelReco/PIDFiles/LowMomMuPiSeparation/TMVAClassification_BDTG_l5_09GeVP_clusterinfo.weights.xml ${ProductionDir}/HighLevelReco/PIDFiles/LowMomMuPiSeparation/TMVAClassification_BDTG_l5_10GeVP_clusterinfo.weights.xml ${ProductionDir}/HighLevelReco/PIDFiles/LowMomMuPiSeparation/TMVAClassification_BDTG_l5_11GeVP_clusterinfo.weights.xml ${ProductionDir}/HighLevelReco/PIDFiles/LowMomMuPiSeparation/TMVAClassification_BDTG_l5_12GeVP_clusterinfo.weights.xml ${ProductionDir}/HighLevelReco/PIDFiles/LowMomMuPiSeparation/TMVAClassification_BDTG_l5_13GeVP_clusterinfo.weights.xml ${ProductionDir}/HighLevelReco/PIDFiles/LowMomMuPiSeparation/TMVAClassification_BDTG_l5_14GeVP_clusterinfo.weights.xml ${ProductionDir}/HighLevelReco/PIDFiles/LowMomMuPiSeparation/TMVAClassification_BDTG_l5_15GeVP_clusterinfo.weights.xml ${ProductionDir}/HighLevelReco/PIDFiles/LowMomMuPiSeparation/TMVAClassification_BDTG_l5_16GeVP_clusterinfo.weights.xml ${ProductionDir}/HighLevelReco/PIDFiles/LowMomMuPiSeparation/TMVAClassification_BDTG_l5_17GeVP_clusterinfo.weights.xml ${ProductionDir}/HighLevelReco/PIDFiles/LowMomMuPiSeparation/TMVAClassification_BDTG_l5_18GeVP_clusterinfo.weights.xml ${ProductionDir}/HighLevelReco/PIDFiles/LowMomMuPiSeparation/TMVAClassification_BDTG_l5_19GeVP_clusterinfo.weights.xml ${ProductionDir}/HighLevelReco/PIDFiles/LowMomMuPiSeparation/TMVAClassification_BDTG_l5_20GeVP_clusterinfo.weights.xml </parameter>
  <!--dE/dx parameters for each particle-->
  <!-- Parameters for 2020 DST (and all generated with v02-02 and v02-02-01 -->
  <parameter name="dEdxParameter_electron" type="FloatVec"> -0.00232937 -3.88424e+13 -37881.1 -1.56837 0 </parameter>
  <parameter name="dEdxParameter_muon" type="FloatVec"> 0.0717375 -16596.5 -4.84028e+07 0.356728 0.000371431 </parameter>
  <parameter name="dEdxParameter_pion" type="FloatVec"> 0.0733683 51678.4 8.19644e+07 0.453505 0.000404984 </parameter>
  <parameter name="dEdxParameter_kaon" type="FloatVec"> 0.0792784 3798.12 4.06952e+07 0.450671 0.00050169 </parameter>
  <parameter name="dEdxParameter_proton" type="FloatVec"> 0.0770318 1053.24 4.95076e+06 0.281489 0.000168616 </parameter>
  <!--dE/dx normalization-->
  <parameter name="dEdxNormalization" type="float">1.350e-7</parameter>
  <!--dE/dx error factor(7.55 for l5, 8.53 for s5)-->
  <parameter name="dEdxErrorFactor" type="float">7.55</parameter>
  <!-- Method: Maximum Likelihood(0), Bayesian(1), or risk based Bayesian(2)-->
  <parameter name="UseBayesian" type="int">2</parameter>
  <!-- Cost Matrix for risk based Bayesian(2)-->
  <parameter name="CostMatrix" type="FloatVec">1.0e-50 1.0 1.5 1.0 1.5 1.0 1.0e-50 3.0 1.0 1.0 1.0 1.0 1.0e-50 1.0 3.0 1.0 1.0 4.0 1.0e-50 2.0 1.0 1.0 5.0 1.0 1.0e-50</parameter>
  <!--Version to be added to the name of the calculated methods-->
  <parameter name="PIDMethodsToRun_version" type="string"> v2 </parameter>
  <!--Name of the PFO collection-->
  <parameter name="RecoParticleCollection" type="string"> PandoraPFOs </parameter>
</processor>

<processor name="LeptonID" type="LeptonIDProcessor">
  <!--verbosity level of this processor ("DEBUG0-4,MESSAGE0-4,WARNING0-4,ERROR0-4,SILENT")-->
  <parameter name="Verbosity" type="string"> MESSAGE </parameter>
  <parameter name="BuildTree" type="bool">false</parameter>
  <parameter name="EvalMVA" type="bool">true</parameter>
  <parameter name="weightfile">${ProductionDir}/HighLevelReco/PIDFiles/CPID/LeptonID_multi_jet_dEdx_800t_3d_cm50r50_BDTG.weights.xml</parameter>
</processor>

<processor name="ComprehensivePID" type="ComprehensivePIDProcessor">
  <parameter name="Verbosity" type="string"> DEBUG </parameter>
  <parameter name="PFOCollection" type="string" value="PandoraPFOs"/>
  <parameter name="RecoMCTruthLink" type="string" value="RecoMCTruthLink"/>

  <parameter name="modeExtract" type="bool" value="true" />
  <parameter name="modeTrain"   type="bool" value="false"/>
  <parameter name="modeInfer"   type="bool" value="true"/>

  <parameter name="TTreeFileName" type="string" value="TTreeFile.root"/>
  <parameter name="reffile" type="string" value="" />
  <parameter name="signalPDGs" type="FloatVec" value="11 13 211 321 2212"/>
  <parameter name="backgroundPDGs" type="FloatVec" value=""/>
  
  <parameter name="plotFolder" type="string" value="CPID_Plots"/>
  <parameter name="fileFormat" type="string" value=".png"/>

  <parameter name="momMin" type="float" value="1"/>
  <parameter name="momMax" type="float" value="100"/>
  <parameter name="momLog" type="bool" value="true"/>
  <parameter name="momNBins" type="float" value="12"/>

  <parameter name="cutD0" type="float" value="0"/>
  <parameter name="cutZ0" type="float" value="0"/>
  <parameter name="cutLamMin" type="float" value="0"/>
  <parameter name="cutLamMax" type="float" value="0"/>
  <parameter name="cutNTracksMin" type="int" value="1"/>
  <parameter name="cutNTracksMax" type="int" value="-1"/>
  
  <parameter name="inputAlgoSpecs" type="StringVec">
    dEdx_RCD:dEdx_RCD
    Pandora
    LeptonID
  </parameter>

  <parameter name="dEdx_RCD.F" type="FloatVec">
    -2.40638e-03   7.10337e-01   2.87718e-01   -1.71591e+00   0.00000e+00
    8.11408e-02   9.92207e-01   7.58509e+05   -1.70167e-01   4.63670e-04
    8.10756e-02   -1.45051e+06   -3.09843e+04   2.84056e-01   3.38131e-04
    7.96117e-02   4.13335e+03   1.13577e+06   1.80555e-01   -3.15083e-04
    7.78772e-02   4.49300e+04   9.13778e+04   1.50088e-01   -6.64184e-04
    1
  </parameter>

  <parameter name="trainModelSpecs" type="StringVec">
    TMVA_BDT_MC:TMVA_BDT_MC_12bins_singleP
  </parameter>
  <parameter name="trainingObservables" type="StringVec"> </parameter>

  <parameter name="TMVA_BDT_MC_12bins_singleP.S" type="StringVec">
    !V:!Silent:Color:DrawProgressBar:Transformations=I;D;P;G,D:AnalysisType=multiclass
    SplitMode=Random:NormMode=NumEvents:!V
    !V:!H:NTrees=1000:BoostType=Grad:Shrinkage=0.10:UseBaggedBoost:BaggedSampleFraction=0.50:nCuts=30:MaxDepth=5
    dEdx_RCD_piDis>-900&&dEdx_RCD_kaDis>-900
  </parameter>
</processor>

<processor name="ParticleIDFilter" type="ReconstructedParticleParticleIDFilterProcessor">
    <parameter name="RecoParticleCollection" type="string" value="PandoraPFOs"/>
    <parameter name="FilterPIDAlgos" type="StringVev" value="BasicVariablePID LikelihoodPID LowMomMuID ShowerShapesPID dEdxPID"/>
    <parameter name="Verbosity" type="string" value="DEBUG"/>
</processor>

<processor name="StoreVariablesForDeepMLFlavorTagger_6J" type="StoreVariablesForDeepMLFlavorTagger">
  <parameter name="CollectionPrimaryVertex" type="string" value="PrimaryVertex" />
  <parameter name="CollectionRefinedJets" type="string" value="Refined6Jets"> </parameter>
  <parameter name="CollectionRefinedVertices" type="string" value="RefinedVertex6Jets" />
  <parameter name="CollectionPFOs" type="string" value="PandoraPFOs" /> 
  <parameter name="D0ProbFileName" type="string" value="${ILDConfigDir}/LCFIPlusConfig/vtxprob/d0probv2_ildl5_6q500.root"/> <!-- vtxprob/d0probv2_ildl5_6q500.root -->
  <parameter name="Z0ProbFileName" type="string" value="${ILDConfigDir}/LCFIPlusConfig/vtxprob/z0probv2_ildl5_6q500.root"/>
  <parameter name="dEdxPID" type="string" value="dEdxPIDv2"/>
  <parameter name="CPIDName" type="string" value="None" />
  <parameter name="WriteDeepjetFeatures" type="bool" value="false"/>
  <parameter name="ParticleNetFeatures_PFPoints" type="StringVec"> RapidityRelJet PhiRelJet </parameter>
  <parameter name="ParticleNetFeatures_PFFeatures" type="StringVec"> TransverseMomentumConstituentLOG EnergyConstituentLOG 
  TransverseMomentumFracConstituentLOG EnergyFracLOG DeltaRJet Charge IsElectron IsMuon IsChargedHadron IsNeutralHadron IsPhoton 
  RapidityRelJet PhiRelJet Rapidity D0 D0Sig Z0 Z0Sig 3DImpactPar 3DImpactParSig D0bprob D0cprob D0qprob Z0bprob Z0cprob Z0qprob
  UsedinPrimVertex LeptonMomRelJet Kaoness Chi2NDF LeptonMomFraction WeightedKaonnessMomFrac JetDotProductNorm HCalFrac </parameter>
  <parameter name="ParticleNetFeatures_SVPoints" type="StringVec"> SecondaryVertexRapidityJetAxis SecondaryVertexPhiJetAxis </parameter>
  <parameter name="ParticleNetFeatures_SVFeatures" type="StringVec"> SecondaryVertexPtLOG SecondaryVertexMass SecondaryVertexNTracks 
  SecondaryVertexChi2NDF SecondaryVertexD0 SecondaryVertexD0Sig SecondaryVertexImpactPar3d SecondaryVertexImpactPar3dSig 
  SecondaryVertexRapidityJetAxis SecondaryVertexPhiJetAxis SecondaryVertexCosMomPos SecondaryVertexEnergyJetEnergy
  SecondaryVertexEnergy SecondaryVertexRapidity JetRapidity </parameter> 
</processor>
 
 <processor name="ParticleNetTagger_6J" type="ParticleNetNTaggerProcessor">
  <!--ParticleNetTaggerProcessor offers Jet tagging using a Deep-Learning model-->
  <!--Torch script file describing the model-->
  <parameter name="ModelScriptFile" type="string"> models/particlenet_4tags.pt </parameter>

  <!--verbosity level of this processor ("DEBUG0-4,MESSAGE0-4,WARNING0-4,ERROR0-4,SILENT")-->
  <parameter name="Verbosity" type="string">DEBUG </parameter>
  <parameter name="CollectionRefinedJets" type="string" value="Refined6Jets"> </parameter>
  <parameter name="CollectionRefinedVertices" type="string" value="RefinedVertex6Jets" />
  <parameter name="CollectionPFOs" type="string" value="PandoraPFOs" /> 
  <parameter name="TagNames" type="StringVec"> b c s ud </parameter>
  <parameter name="ParticleNetFeatures_PFPoints" type="StringVec"> RapidityRelJet PhiRelJet</parameter>
  <parameter name="ParticleNetFeatures_PFFeatures" type="StringVec">
      RapidityRelJet Rapidity PhiRelJet TransverseMomentumConstituentLOG
      EnergyConstituentLOG TransverseMomentumFracConstituentLOG EnergyFracLOG DeltaRJet
      D0 D0Sig Z0 Z0Sig
      3DImpactPar 3DImpactParSig Charge IsElectron
      IsMuon IsChargedHadron IsNeutralHadron IsPhoton
      D0bprob D0cprob D0qprob Z0bprob 
      Z0cprob Z0qprob UsedinPrimVertex LeptonMomRelJet
      Kaoness Chi2NDF LeptonMomFraction WeightedKaonnessMomFrac
      <!-- CPID11ness CPID13ness CPID211ness CPID321ness CPID2212ness -->
      JetDotProductNorm HCalFrac </parameter>
  <parameter name="ParticleNetFeatures_SVPoints" type="StringVec"> SecondaryVertexRapidityJetAxis SecondaryVertexPhiJetAxis</parameter>
  <parameter name="ParticleNetFeatures_SVFeatures" type="StringVec"> SecondaryVertexRapidityJetAxis SecondaryVertexRapidity SecondaryVertexPhiJetAxis SecondaryVertexPtLOG SecondaryVertexMass SecondaryVertexNTracks SecondaryVertexChi2NDF SecondaryVertexD0 SecondaryVertexD0Sig SecondaryVertexImpactPar3d SecondaryVertexImpactPar3dSig SecondaryVertexCosMomPos
  SecondaryVertexEnergyJetEnergy SecondaryVertexEnergy </parameter>
  <parameter name="MeanPFFeatures" type="FloatVec">
        1.85743122e-04  2.40487332e-03  1.81789046e-03 -1.27853482e-01
        5.33305498e-02 -1.69318656e+00 -1.72301753e+00  4.97598549e-01
       -5.28327587e+00 -4.24195355e+00 -5.24586681e+00 -5.15909166e+00
       -1.57654329e+00  3.11700418e+01  2.65937586e-03  3.63942916e-02
        4.61831737e-03  4.34209214e-01  1.03472656e-01  4.21305521e-01
       -5.20339278e+00 -5.22533587e+00 -5.21741391e+00 -5.09274600e+00
       -5.17688543e+00 -5.18726326e+00 -4.90826457e+00 -7.34807843e+00
       -5.05768300e+00 -4.69456532e+00 -7.94565978e+00 -5.23867466e+00
       <!-- -5.24675695e+00 -5.23477763e+00 -4.91842049e+00 -5.21791657e+00 -5.24074720e+00 -->
       -3.85513216e+00 -4.73270146e+00</parameter>
   <parameter name="MeanSVFeatures" type="FloatVec">
       8.25094525e-04 5.13830793e-03 6.92837612e-04 9.40945104e-01
       1.12108027e+00 2.83253258e+00 7.26346660e+00 4.09344177e+00
       2.22437604e+10 5.24616933e+00 3.21666845e+10 9.77182427e-01
       2.60855682e-01 1.55794235e+01 </parameter>
    <parameter name="StdPFFeatures" type="FloatVec">
       5.22546578e-01 1.04354138e+00 5.94739508e-01 5.69255292e-01
       5.28232650e-01 5.74327009e-01 5.43753526e-01 4.79173884e-01
       1.99831495e+01 6.70050379e+02 2.18397521e+01 7.83554712e+02
       2.96102998e+01 8.14136356e+02 6.89358216e-01 1.87269184e-01
       6.78010952e-02 4.95652673e-01 3.04575222e-01 4.93768345e-01
       5.04250674e+00 5.01794188e+00 5.02699293e+00 5.16041905e+00
       5.06920965e+00 5.05853967e+00 5.35968971e+00 5.62795562e+00
       5.19791700e+00 5.65526699e+00 4.05476418e+00 5.00348680e+00
       <!-- 5.01527334e+00 5.02748641e+00 5.36566899e+00 5.04629258e+00 5.02116024e+00 -->
       7.25313695e+00 5.02730574e+00 </parameter>
    <parameter name="StdSVFeatures" type="FloatVec">
       1.93090237e-01 7.86925921e-01 2.29787151e-01 3.73752464e-01
       8.11406920e-01 1.39863038e+00 3.08915394e+02 1.42217724e+01
       7.06567496e+12 1.91142796e+01 9.46842425e+12 1.01111643e-01
       1.69965923e-01 1.19961315e+01 </parameter>
</processor>

<processor name="ParticleIDFilter_6J" type="ReconstructedParticleParticleIDFilterProcessor">
    <parameter name="RecoParticleCollection" type="string" value="PandoraPFOs"/>
    <parameter name="FilterPIDAlgos" type="StringVev" value="mlflavortagging_pf_features mlflavortagging_pf_points mlflavortagging_sv_features mlflavortagging_sv_points"/>
    <parameter name="Verbosity" type="string" value="DEBUG"/>
</processor>

<processor name="LCIOOutputProcessor" type="LCIOOutputProcessor">
  <!-- DST output: drop all hits, skim MCParticles and keep final Tracks, Clusters, Vertices and  ReconstructedParticles -->
  <parameter name="LCIOOutputFile" type="string" >
   ${OutputDir}/FT_${OutputSuffix}.slcio
  </parameter>
  <parameter name="DropCollectionTypes" type="StringVec">
    Track
    Cluster
  </parameter>
  <parameter name="DropCollectionNames" type="StringVec">
    ClusterMCTruthLink
    MCTruthClusterLink
    MCTruthMarlinTrkTracksLink
    MarlinTrkTracksMCTruthLink
    DistilledPFOs
    GammaGammaCandidateEtaPrimes
    GammaGammaCandidateEtas
    GammaGammaCandidatePi0s
    GammaGammaParticles
    V0RecoParticles
    V0Vertices
    ProngRecoParticles
    ProngVertices
    KinkRecoParticles
    KinkVertices
    SplitRecoParticles
    SplitVertices
    BuildUpVertex_RP
    BuildUpVertex
    BuildUpVertex_V0_RP
    BuildUpVertex_V0
    Vertex6Jets
    Refined6Jets_vtx
    Refined6Jets_vtx_RP
    RefinedVertex2Jets
    RefinedVertex3Jets
    RefinedVertex4Jets
    RefinedVertex5Jets
    RefinedVertex6Jets
    RefinedVertex2Jets_RP
    RefinedVertex3Jets_RP
    RefinedVertex4Jets_RP
    RefinedVertex5Jets_RP
    RefinedVertex6Jets_RP
    Refined2JetsEF
    Refined3JetsEF
    Refined4JetsEF
    Refined5JetsEF
    Refined6JetsEF
    BCALMCTruthLink
    MCTruthBcalLink
    MCTruthTrackLink
    TrackMCTruthLink
  </parameter>
  <parameter name="LCIOWriteMode" type="string" value="WRITE_NEW"/>
  <parameter name="CompressionLevel" type="int" value="6"/>
  <!--parameter name="SplitFileSizekB" type="int" value="1992294"/-->
</processor>

</marlin>
